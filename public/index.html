<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>MapLibre Rectangle + 3D Buildings</title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

    <style>
        /* ==========================================================================*/
        /*  Theme tokens (CSS variables)                                              */
        /* ==========================================================================*/

        :root {
            /* Layout */
            --topbar-h: 56px;
            --left-panel-w: 220px;
            --right-panel-w: 220px;

            /* Panel + text */
            --topbar-bg: rgba(245, 245, 245, 0.55);
            --panel-bg: rgba(245, 245, 245, 0.65);
            --panel-border: rgba(0, 0, 0, 0.10);
            --text: #111;
            --muted: rgba(0, 0, 0, 0.55);
            --brand-yellow: rgba(250, 218, 54, 1);
            --brand-yellow-border: rgb(250, 194, 54);

            /* Buttons (Chart.js-ish palette) */
            --btn-primary-bg: rgb(54, 162, 235);
            --btn-primary-border: rgb(54, 162, 235);
            --btn-primary-text: #fff;

            /* teal */
            --btn-success-bg: rgb(75, 192, 192);
            --btn-success-border: rgb(75, 192, 192);
            --btn-success-text: #fff;

            /* Clear button (Chart.js orange) */
            --btn-clear-bg: rgb(255, 159, 64);
            --btn-clear-border: rgb(255, 159, 64);
            --btn-clear-text: #fff;
            /* or #fff if you prefer */

            /* Switches */
            --switch-on: rgb(153, 102, 255);
            /* purple accent */
            --switch-off-bg: rgba(201, 203, 207, 0.25);
            --switch-off-border: rgba(201, 203, 207, 0.9);

            /* Effects */
            --panel-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        html[data-ui-theme="dark"] {
            --topbar-bg: rgba(22, 22, 27, 0.55);
            --panel-bg: rgba(22, 22, 27, 0.62);
            --panel-border: rgba(255, 255, 255, 0.12);
            --text: #ebebeb;
            --muted: rgba(255, 255, 255, 0.65);

            --btn-clear-bg: rgba(255, 255, 255, 0.10);
            --btn-clear-border: rgba(255, 255, 255, 0.35);

            --switch-off-bg: rgba(255, 255, 255, 0.10);
            --switch-off-border: rgba(255, 255, 255, 0.35);

            --panel-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
        }

        /* ==========================================================================*/
        /*  Global layout reset                                                      */
        /* ==========================================================================*/

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        /* ==========================================================================*/
        /*  Shell layout: topbar + side panels + map                                  */
        /* ==========================================================================*/

        #topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--topbar-h);
            z-index: 20;

            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
        }

        #topbar.map-panel {
            background: var(--topbar-bg);
            border-left: 0;
            border-right: 0;
            border-top: 0;
            border-radius: 0;
        }

        .topbar-inner {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 16px;
        }

        #topbarLogo {
            height: 28px;
            width: auto;
            display: block;
        }

        .topbar-title {
            font-weight: 600;
            letter-spacing: 0.2px;
        }

        #toolbar {
            position: fixed;
            top: var(--topbar-h);
            left: 0;
            bottom: 0;
            width: var(--left-panel-w);
            z-index: 10;

            overflow-y: auto;
            border-radius: 0;
        }

        #statsPanel {
            position: fixed;
            top: var(--topbar-h);
            right: 0;
            bottom: 0;
            width: var(--right-panel-w);
            z-index: 10;

            overflow-y: auto;
            border-radius: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #toolbar .card-body,
        #statsPanel .card-body {
            padding: 16px;
        }

        /* ==========================================================================*/
        /*  Panel “glass” look + typography inside panels                             */
        /* ==========================================================================*/

        .map-panel {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--text);
            box-shadow: var(--panel-shadow);
        }

        .map-panel .form-select,
        .map-panel .form-check-label,
        .map-panel .btn,
        .map-panel .text-muted,
        .map-panel .form-label {
            color: var(--text);
        }

        .map-panel .text-muted {
            color: var(--muted) !important;
        }

        /* ==========================================================================*/
        /*  Buttons + switches                                                       */
        /* ==========================================================================*/

        #drawButton {
            background-color: var(--btn-primary-bg);
            border-color: var(--btn-primary-border);
            color: var(--btn-primary-text);
        }

        #build3DButton {
            background-color: var(--btn-success-bg);
            border-color: var(--btn-success-border);
            color: var(--btn-success-text);
        }

        #clearButton {
            background: var(--btn-clear-bg);
            border-color: var(--btn-clear-border);
            color: var(--btn-clear-text);
        }

        .form-check-input {
            background-color: var(--switch-off-bg);
            border-color: var(--switch-off-border);
        }

        .form-check-input:checked {
            background-color: var(--switch-on);
            border-color: var(--switch-on);
        }

        #drawButton:hover {
            filter: brightness(0.95);
        }

        #build3DButton:hover {
            filter: brightness(0.95);
        }

        #clearButton:hover {
            filter: brightness(0.95);
        }

        /* ==========================================================================*/
        /*  Dropdown tweaks for dark UI theme                                         */
        /* ==========================================================================*/

        html[data-ui-theme="dark"] .map-panel .form-select {
            background-color: rgba(37, 37, 37, 0.7);
            border-color: rgba(255, 255, 255, 0.18);
            color: #fff;
        }

        html[data-ui-theme="dark"] .map-panel .form-select option {
            background-color: #151515;
            color: #fff;
        }

        html[data-ui-theme="dark"] .map-panel .form-select:focus {
            border-color: rgba(255, 255, 255, 0.28);
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.12);
        }

        html[data-ui-theme="dark"] #topbar .topbar-title {
            color: var(--brand-yellow);
        }

        /* ==========================================================================*/
        /*  Stats panel components                                                   */
        /* ==========================================================================*/

        .panel-block {
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 0.5rem;
        }

        .chart-box {
            position: relative;
            width: 100%;
        }

        .chart-box--bar {
            height: 160px;
        }

        .chart-box--pie {
            height: 220px;
        }
    </style>
</head>


<body>
    <!-- Top bar -->
    <header id="topbar" class="map-panel">
        <div class="topbar-inner">
            <img id="topbarLogo" src="./dtcc-logo.png" alt="DTCC logo" />
            <div class="topbar-title">DTCC Platform</div>
        </div>
    </header>

    <!-- Toolbar panel -->
    <div id="toolbar" class="card shadow-sm map-panel">
        <div class="card-body p-3">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <div class="fw-semibold">Controls</div>
                <span class="badge text-bg-secondary">DTCC</span>
            </div>

            <!-- Theme -->
            <div class="mb-3">
                <label for="themeSelect" class="form-label mb-1">Theme</label>
                <select id="themeSelect" class="form-select form-select-sm">
                    <option value="light" selected>Light</option>
                    <option value="dark">Dark</option>
                    <option value="default">Default</option>
                </select>
            </div>

            <!-- Buttons -->
            <div class="d-grid gap-2 mb-3">
                <button id="drawButton" class="btn btn-sm btn-dt-draw">
                    Draw rectangle
                </button>

                <!-- Build options (hidden until a selection exists) -->
                <div id="buildOptions" class="vstack gap-2 d-none">
                    <div class="small text-muted">Include in build</div>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="includeBuildings" checked>
                        <label class="form-check-label" for="includeBuildings">Buildings</label>
                    </div>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="includeBuses">
                        <label class="form-check-label" for="includeBuses">Buses</label>
                    </div>
                </div>
                <button id="build3DButton" class="btn btn-sm btn-dt-build">
                    Build Twin
                </button>

                <!-- Toggles -->
                <div id="toggles" class="vstack gap-2 mb-3 d-none">
                    <div id="toggleSelectionRow" class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleSelection" checked>
                        <label class="form-check-label" for="toggleSelection">Show selection</label>
                    </div>

                    <div id="toggleBuildingsRow" class="form-check form-switch d-none">
                        <input class="form-check-input" type="checkbox" id="toggleBuildings" checked>
                        <label class="form-check-label" for="toggleBuildings">Show buildings</label>
                    </div>

                    <div id="toggleBusesRow" class="form-check form-switch d-none">
                        <input class="form-check-input" type="checkbox" id="toggleBuses" checked>
                        <label class="form-check-label" for="toggleBuses">Show buses</label>
                    </div>
                </div>


                <button id="clearButton" class="btn btn-sm btn-dt-clear">
                    Clear
                </button>
            </div>
        </div>
    </div>

    <!-- Stats panel (right side) -->
    <div id="statsPanel" class="card shadow-sm map-panel">
        <div class="card-body p-3">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="fw-semibold">Model stats</div>
                <span id="statsStatus" class="badge text-bg-secondary">No model</span>
            </div>

            <!-- Key stats block -->
            <div class="panel-block mb-3">
                <div class="small text-muted mb-2">Summary</div>

                <div class="vstack gap-2 small">
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Selected buildings</span>
                        <span id="statBuildings">–</span>
                    </div>

                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Selection area</span>
                        <span id="statArea">–</span>
                    </div>

                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Buses enabled</span>
                        <span id="statBuses">–</span>
                    </div>
                </div>
            </div>

            <!-- Chart block -->
            <div class="panel-block mb-3">
                <div class="d-flex align-items-baseline justify-content-between mb-2">
                    <div class="small text-muted">Height distribution</div>
                    <div class="small text-muted">m</div>
                </div>
                <canvas id="statsChart" height="140"></canvas>
            </div>

            <!-- Chart block -->
            <div class="panel-block">
                <div class="d-flex align-items-baseline justify-content-between mb-2">
                    <div class="small text-muted">Building types</div>
                    <div class="small text-muted">count</div>
                </div>

                <div class="chart-box chart-box--pie">
                    <canvas id="typesChart"></canvas>
                </div>
            </div>


            <div class="small text-muted mt-3" id="statNote">
                Draw a rectangle and build to see statistics here.
            </div>




        </div>
    </div>



    <div id="map"></div>

    <!-- MapLibre + Turf as globals -->
    <script src="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

    <!-- Bootstrap JS bundle (optional; only needed for dropdowns/modals/tooltips etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Chart.js for stats panel -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>


    <!-- Your entry file -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>