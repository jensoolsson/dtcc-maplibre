<!DOCTYPE html>
<html lang="en" data-ui-palette="dtcc1">

<head>
    <meta charset="utf-8" />
    <title>MapLibre Rectangle + 3D Buildings</title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

    <style>
        /* ==========================================================================*/
        /*  Theme tokens (CSS variables)                                              */
        /* ==========================================================================*/

        :root {
            /* Layout */
            --topbar-h: 56px;
            --left-panel-w: 220px;
            --right-panel-w: 220px;

            /* Panel + text */
            --topbar-bg: rgba(245, 245, 245, 0.55);
            --panel-bg: rgba(245, 245, 245, 0.65);
            --panel-border: rgba(0, 0, 0, 0.10);
            --text: #111;
            --muted: rgba(0, 0, 0, 0.55);
            --brand-yellow: rgba(250, 218, 54, 1);
            --brand-yellow-border: rgb(250, 194, 54);

            /* Buttons (Chart.js-ish palette) */
            --btn-primary-bg: rgb(54, 162, 235);
            --btn-primary-border: rgb(54, 162, 235);
            --btn-primary-text: #fff;

            /* teal */
            --btn-success-bg: rgb(75, 192, 192);
            --btn-success-border: rgb(75, 192, 192);
            --btn-success-text: #fff;

            /* Clear button (Chart.js orange) */
            --btn-clear-bg: rgb(255, 159, 64);
            --btn-clear-border: rgb(255, 159, 64);
            --btn-clear-text: #fff;
            /* or #fff if you prefer */

            /* Switches */
            --switch-on: rgb(153, 102, 255);
            --switch-off-bg: rgba(201, 203, 207, 0.25);
            --switch-off-border: rgba(201, 203, 207, 0.9);

            /* Effects */
            --panel-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        html[data-ui-theme="dark"] {
            --topbar-bg: rgba(22, 22, 27, 0.55);
            --panel-bg: rgba(22, 22, 27, 0.62);
            --panel-border: rgba(255, 255, 255, 0.12);
            --text: #ebebeb;
            --muted: rgba(255, 255, 255, 0.65);

            --btn-clear-bg: rgba(255, 255, 255, 0.10);
            --btn-clear-border: rgba(255, 255, 255, 0.35);

            --switch-off-bg: rgba(255, 255, 255, 0.10);
            --switch-off-border: rgba(255, 255, 255, 0.35);

            --panel-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
        }

        /* ==========================================================================*/
        /*  UI palettes                                                              */
        /* ==========================================================================*/

        /* Default palette (Chart.js-like) */
        html[data-ui-palette="chartjs"] {
            --ui-accent: rgb(54, 162, 235);
            --ui-accent-2: rgb(153, 102, 255);
            --ui-ok: rgb(75, 192, 192);
            --ui-warn: rgb(255, 159, 64);
            --ui-danger: rgb(255, 99, 132);

            --ui-text: var(--text);
            --ui-muted: var(--muted);

            /* colours for charts (ordered) */
            --chart-1: rgb(54, 162, 235);
            --chart-2: rgb(75, 192, 192);
            --chart-3: rgb(255, 205, 86);
            --chart-4: rgb(153, 102, 255);
            --chart-5: rgb(255, 159, 64);
            --chart-6: rgb(201, 203, 207);
            --chart-7: rgb(255, 99, 132);
        }

        /* Your diverging palette */
        html[data-ui-palette="diverging"] {
            --ui-accent: #00429d;
            --ui-accent-2: #4771b2;
            --ui-ok: #73a2c6;
            --ui-warn: #ffbcaf;
            --ui-danger: #cf3759;

            --ui-text: var(--text);
            --ui-muted: var(--muted);

            --chart-1: #00429d;
            --chart-2: #4771b2;
            --chart-3: #73a2c6;
            --chart-4: #a5d5d8;
            --chart-5: #ffbcaf;
            --chart-6: #f4777f;
            --chart-7: #cf3759;
            --chart-8: #93003a;
            --chart-9: #ffffe0;
        }


        html[data-ui-palette="dtcc1"] {
            --ui-accent: #47726A;
            --ui-accent-2: #07352E;
            --ui-ok: #89B6AD;
            --ui-warn: #E1D279;
            --ui-danger: #9A8D17;

            --ui-text: var(--text);
            --ui-muted: var(--muted);

            --chart-1: #47726A;
            --chart-2: #67948B;
            --chart-3: #89B6AD;
            --chart-4: #B3D8D0;
            --chart-5: #F5F5F5;
            --chart-6: #E1D279;
            --chart-7: #BFAF3D;
            --chart-8: #9A8D17;
            --chart-9: #776D00;
        }

        html[data-ui-palette="dtcc2"] {
            --ui-accent: #36635B;
            --ui-accent-2: #07352E;
            --ui-ok: #9AC8BE;
            --ui-warn: #D2C050;
            --ui-danger: #9A8D17;

            --ui-text: var(--text);
            --ui-muted: var(--muted);

            --chart-1: #07352E;
            --chart-2: #36635B;
            --chart-3: #67948B;
            --chart-4: #9AC8BE;
            --chart-5: #F5F5F5;
            --chart-6: #D2C050;
            --chart-7: #9A8D17;
            --chart-8: #675D00;
            --chart-9: #383000;
        }


        html[data-ui-palette="candy"] {
            --ui-accent: #845EC2;
            --ui-accent-2: #D65DB1;
            --ui-ok: #FF6F91;
            --ui-warn: #FF9671;
            --ui-danger: #FFC75F;

            --ui-text: var(--text);
            --ui-muted: var(--muted);

            --chart-1: #845EC2;
            --chart-2: #D65DB1;
            --chart-3: #FF6F91;
            --chart-4: #FF9671;
            --chart-5: #FFC75F;
            --chart-6: #F9F871;
        }



        /* ==========================================================================*/
        /*  Global layout reset                                                      */
        /* ==========================================================================*/

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        /* ==========================================================================*/
        /*  Shell layout: topbar + side panels + map                                  */
        /* ==========================================================================*/

        #topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--topbar-h);
            z-index: 20;

            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
        }

        #topbar.map-panel {
            background: var(--topbar-bg);
            border-left: 0;
            border-right: 0;
            border-top: 0;
            border-radius: 0;
        }

        .topbar-inner {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 16px;
        }

        #topbarLogo {
            height: 28px;
            width: auto;
            display: block;
        }

        .topbar-title {
            font-weight: 600;
            letter-spacing: 0.2px;
            font-size: 1.125rem;
        }

        #toolbar {
            position: fixed;
            top: var(--topbar-h);
            left: 0;
            bottom: 0;
            width: var(--left-panel-w);
            z-index: 10;

            overflow-y: auto;
            border-radius: 0;
        }

        #statsPanel {
            position: fixed;
            top: var(--topbar-h);
            right: 0;
            bottom: 0;
            width: var(--right-panel-w);
            z-index: 10;

            overflow-y: auto;
            border-radius: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #toolbar .card-body,
        #statsPanel .card-body {
            padding: 16px;
        }

        /* ==========================================================================*/
        /*  Panel “glass” look + typography inside panels                             */
        /* ==========================================================================*/

        .map-panel {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--text);
            box-shadow: var(--panel-shadow);
        }

        .map-panel .form-select,
        .map-panel .form-check-label,
        .map-panel .btn,
        .map-panel .text-muted,
        .map-panel .form-label {
            color: var(--text);
        }

        .map-panel .text-muted {
            color: var(--muted) !important;
        }

        /* ==========================================================================*/
        /*  Buttons + switches                                                       */
        /* ==========================================================================*/

        /* Buttons use palette accents (easy to try new palettes) */
        #drawButton {
            background-color: var(--ui-accent);
            border-color: var(--ui-accent);
            color: #fff;
        }

        #build3DButton {
            background-color: var(--ui-accent);
            border-color: var(--ui-accent);
            color: #fff;
        }

        #clearButton {
            background-color: var(--ui-warn);
            border-color: var(--ui-warn);
            color: #111;
        }

        .form-check-input:checked {
            background-color: var(--ui-accent-2);
            border-color: var(--ui-accent-2);
        }

        .form-check-input {
            background-color: var(--switch-off-bg);
            border-color: var(--switch-off-border);
        }


        #drawButton:hover {
            filter: brightness(0.95);
        }

        #build3DButton:hover {
            filter: brightness(0.95);
        }

        #clearButton:hover {
            filter: brightness(0.95);
        }

        /* ==========================================================================*/
        /*  Dropdown tweaks for dark UI theme                                         */
        /* ==========================================================================*/

        html[data-ui-theme="dark"] .map-panel .form-select {
            background-color: rgba(37, 37, 37, 0.7);
            border-color: rgba(255, 255, 255, 0.18);
            color: #fff;
        }

        html[data-ui-theme="dark"] .map-panel .form-select option {
            background-color: #151515;
            color: #fff;
        }

        html[data-ui-theme="dark"] .map-panel .form-select:focus {
            border-color: rgba(255, 255, 255, 0.28);
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.12);
        }

        html[data-ui-theme="dark"] #topbar .topbar-title {
            color: var(--brand-yellow);
        }

        /* ==========================================================================*/
        /*  Stats panel components                                                   */
        /* ==========================================================================*/

        .panel-block {
            border: 1px solid var(--panel-border);
            border-radius: 12px;
            padding: 0.5rem;
        }

        .chart-box {
            position: relative;
            width: 100%;
        }

        .chart-box--bar {
            height: 160px;
        }

        .chart-box--pie {
            height: 220px;
        }
    </style>
</head>


<body>
    <!-- Top bar -->
    <header id="topbar" class="map-panel">
        <div class="topbar-inner">
            <img id="topbarLogo" src="./dtcc-logo.png" alt="DTCC logo" />
            <div class="topbar-title">DTCC Platform</div>
        </div>
    </header>

    <!-- Toolbar panel -->
    <div id="toolbar" class="card shadow-sm map-panel">
        <div class="card-body p-2 small">

            <div class="d-flex align-items-center justify-content-between mb-1">
                <div class="fw-semibold">Controls</div>
                <span class="badge text-bg-secondary">DTCC</span>
            </div>

            <!-- Buttons -->
            <div class="d-grid gap-1 mb-2">

                <div class="panel-block">
                    <div class="d-grid gap-1">

                        <button id="drawButton" class="btn btn-sm btn-dt-draw">
                            Draw rectangle
                        </button>

                        <!-- Build options -->
                        <div id="buildOptions" class="vstack gap-0 d-none">
                            <div class="text-muted">Include in build</div>

                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="includeBuildings" checked>
                                <label class="form-check-label" for="includeBuildings">Buildings</label>
                            </div>

                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="includeBuses">
                                <label class="form-check-label" for="includeBuses">Buses</label>
                            </div>
                        </div>

                        <button id="build3DButton" class="btn btn-sm btn-dt-build">
                            Build Twin
                        </button>

                        <!-- Toggles -->
                        <div id="toggles" class="vstack gap-0 d-none">
                            <div id="toggleSelectionRow" class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="toggleSelection" checked>
                                <label class="form-check-label" for="toggleSelection">Show selection</label>
                            </div>

                            <div id="toggleBuildingsRow" class="form-check form-switch d-none">
                                <input class="form-check-input" type="checkbox" id="toggleBuildings" checked>
                                <label class="form-check-label" for="toggleBuildings">Show buildings</label>
                            </div>

                            <div id="toggleBusesRow" class="form-check form-switch d-none">
                                <input class="form-check-input" type="checkbox" id="toggleBuses" checked>
                                <label class="form-check-label" for="toggleBuses">Show buses</label>
                            </div>
                        </div>

                        <button id="clearButton" class="btn btn-sm btn-dt-clear">
                            Clear
                        </button>

                    </div>
                </div>

                <!-- Theme / palette -->
                <div class="panel-block">
                    <div class="mb-1">
                        <label for="themeSelect" class="text-muted">Theme</label>
                        <select id="themeSelect" class="form-select form-select-sm">
                            <option value="light" selected>Light</option>
                            <option value="dark">Dark</option>
                            <option value="default">Default</option>
                        </select>
                    </div>

                    <div class="mb-0">
                        <label for="paletteSelect" class="text-muted">Palette</label>
                        <select id="paletteSelect" class="form-select form-select-sm">
                            <option value="dtcc1" selected>DTCC1</option>
                            <option value="dtcc2">DTCC2</option>
                            <option value="chartjs">Chartjs</option>
                            <option value="diverging">Diverging</option>
                            <option value="candy">Candy</option>
                        </select>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- Stats panel (right side) -->
    <div id="statsPanel" class="card shadow-sm map-panel">
        <div class="card-body p-3">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="fw-semibold">Model stats</div>
                <span id="statsStatus" class="badge text-bg-secondary">No model</span>
            </div>

            <!-- Key stats block -->
            <div class="panel-block mb-3">
                <div class="small text-muted mb-2">Summary</div>

                <div class="vstack gap-2 small">
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Selected buildings</span>
                        <span id="statBuildings">–</span>
                    </div>

                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Selection area</span>
                        <span id="statArea">–</span>
                    </div>

                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Buses enabled</span>
                        <span id="statBuses">–</span>
                    </div>
                </div>
            </div>

            <!-- Chart block -->
            <div class="panel-block mb-3">
                <div class="d-flex align-items-baseline justify-content-between mb-2">
                    <div class="small text-muted">Building heights</div>
                    <div class="small text-muted">m</div>
                </div>
                <canvas id="statsChart" height="140"></canvas>
            </div>

            <!-- Chart block -->
            <div class="panel-block">
                <div class="d-flex align-items-baseline justify-content-between mb-2">
                    <div class="small text-muted">Building types</div>
                    <div class="small text-muted">count</div>
                </div>

                <div class="chart-box chart-box--pie">
                    <canvas id="typesChart"></canvas>
                </div>
            </div>


            <div class="small text-muted mt-3" id="statNote">
                Draw a rectangle and build to see statistics here.
            </div>




        </div>
    </div>



    <div id="map"></div>

    <!-- MapLibre + Turf as globals -->
    <script src="https://unpkg.com/maplibre-gl@5.14.0/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

    <!-- Bootstrap JS bundle (optional; only needed for dropdowns/modals/tooltips etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Chart.js for stats panel -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>


    <!-- Your entry file -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>